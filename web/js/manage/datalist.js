function getTableData(e,a){var t={totalPage:0,totalCount:0,list:null};return $.ajax({type:"POST",async:!1,url:"http://mm.jnrise.cn/loading/server/excel/query",headers:{"Content-Type":"application/json",token:e},data:JSON.stringify(a),dataType:"json",success:function(e){if(0==e.code){var a=new Common;if(t.totalPage=e.simplePage.totalPage,t.totalCount=e.simplePage.totalCount,e.simplePage.list.length>0){t.list=e.simplePage.list;for(var n=0;n<t.list.length;n++)t.list[n].createTime=a.formateTime("yyyy-MM-dd hh:mm:ss",new Date(t.list[n].createTime))}}else t.list=null},error:function(e){console.log(e)}}),t}function getPageData(e,a){var t={};t.index=e+1,1==t.index?t.prev=!1:t.prev=!0,t.index==a?t.next=!1:t.next=!0,t.pagers=[];var n=5*Math.ceil(t.index/5),s=a<n?a:n,o=s-4;for(o<=0&&(o=1),o;o<=s;o++)t.pagers.push(o);return t}function getChannelList(e){var a=[];return $.ajax({type:"GET",async:!1,url:"http://mm.jnrise.cn/loading/server/channel",headers:{token:e},dataType:"json",success:function(e){a=e.channels},error:function(e){console.log(e)}}),a}function getToken(){var e=(new Common).getCookiesChild("mm_login","token");if(null!=e&&""!=e)return e;window.location.href="login.html"}function initPageSize(){var e=parseFloat($(window).height())-60,a=parseFloat($(".containers .content .aside").height());e<a?$(".containers .content .aside").height(a):$(".containers .content .aside").height(e)}$(function(){initPageSize();new Vue({el:"#data",data:{user:{username:"",token:""},search:{page:0,size:20,begin:"",end:"",channels:[]},pagers:{index:1,prev:!1,next:!0,pagers:[1,2,3,4,5]},data:{totalPage:0,totalCount:0,list:null},channel:[]},methods:{searchList:function(){var e=this;e.user.token=getToken(),e.search.begin=$("#start-date").val(),e.search.end=$("#end-date").val(),e.search.channels=[],""!=$("#channel-list").val()&&e.search.channels.push($("#channel-list").val()),e.search.page=0,e.data=getTableData(e.user.token,e.search),e.pagers=getPageData(e.search.page,e.data.totalPage)},prev:function(){var e=this;e.user.token=getToken(),e.search.page--,e.data=getTableData(e.user.token,e.search),e.pagers=getPageData(e.search.page,e.data.totalPage)},next:function(){var e=this;e.user.token=getToken(),e.search.page++,e.data=getTableData(e.user.token,e.search),e.pagers=getPageData(e.search.page,e.data.totalPage)},goto:function(e){var a=this;a.user.token=getToken(),null==e&&((e=parseInt($("#go-page").val()))>a.data.totalPage&&(e=a.data.totalPage),e<1&&(e=1),$("#go-page").val(e)),a.search.page=e-1,a.data=getTableData(a.user.token,a.search),a.pagers=getPageData(a.search.page,a.data.totalPage)},download:function(){var e=this;e.user.token=getToken();var a="http://mm.jnrise.cn/loading/server/excel/download?page="+e.search.page+"&size="+e.search.size+"&begin="+e.search.begin+"&end="+e.search.end;e.search.channels.length>0&&(a=a+"&channelsStr="+e.search.channels[0]),window.location.href=a}},created:function(){var e=this,a=new Common;e.user.token=getToken(),e.search.begin=a.getBeforeDateTime(15),e.search.end=a.getDateTime(),e.channel=getChannelList(e.user.token),e.data=getTableData(e.user.token,e.search),e.pagers=getPageData(e.search.page,e.data.totalPage)}});$(document).keydown(function(e){13===e.keyCode&&consumer.searchList()}),$(window).resize(function(){initPageSize()})});