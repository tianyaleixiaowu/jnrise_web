function getScrollHeight(){var t=0,a=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(a=document.documentElement.scrollHeight),t-a>0?t:a}function isInArray(t,a){for(var n=0;n<t.length;n++)if(a===t[n])return!0;return!1}$(function(){var t={appKey:"qd46yzrfqi2cf",token:"i8aJP8kL+MlVWCVtVawex6+1t+T+IPc7BMxpTPLARm8C/oo23Hbk7ifZXvwbJl9IQqTqnNh7GBlbSk9UvSk2iA=="},a={receiveNewMessage:function(t){if($(".main-left ul li.current").attr("name")==t.targetId){a='<div class="talker-b"><div class="talker-img"></div>&nbsp;<div class="talker-content">'+t.content.content+"</div></div>";$(".main-talking .talking-list:visible").append(a),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}else if(isInArray(n,t.targetId)){$(".main-left ul li[name="+t.targetId+"] span").show();var a='<div class="talker-b"><div class="talker-img"></div>&nbsp;<div class="talker-content">'+t.content.content+"</div></div>";$(".main-talking .talking-list[data-id="+t.targetId+"]").append(a),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}else{n.push(t.targetId);var i='<li name="'+t.targetId+'"><img src="http://cdn.tianyalei.com/mm/rise/page-talk/default.png"><span></span><p>'+t.targetId+"</p></li>",e='<div class="talking-list" data-id="'+t.targetId+'" style="display:none"><div class="talker-b"><div class="talker-img"></div>&nbsp;<div class="talker-content">'+t.content.content+"</div></div></div>";$(".main-left ul").append(i),$(".main-right .main-talking").append(e),$(".main-left ul li[name="+t.targetId+"] span").show(),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}}};init(t,a);var n=[];$.ajax({type:"POST",url:"https://mm.jnrise.cn:88/loading/server/kefu/contact",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{kefuId:"rise"},dataType:"json",success:function(t){if(null!=t.data&&t.data.length>0){n=t.data;for(var a="",i="",e=0;e<t.data.length;e++)a+='<li name="'+t.data[e]+'"><img src="http://cdn.tianyalei.com/mm/rise/page-talk/default.png"><span></span><p>'+t.data[e]+"</p></li>",i+='<div class="talking-list" data-id="'+t.data[e]+'"></div>';$(".main-left ul").append(a),$(".main-right .main-talking").append(i),$(".main-left ul li").removeClass("current").eq(0).addClass("current"),$(".main-right .main-talking .talking-list").hide().eq(0).show(),$(".main-right .main-header h4 span").html(t.data[0])}},error:function(t){console.log(t)}}),$(".main-left ul").on("click","li",function(){var t=$(this).index();$(".main-left ul li").removeClass("current").eq(t).addClass("current").find("span").hide(),$(".main-right .main-talking .talking-list").hide().eq(t).show(),$(".main-right .main-header h4 span").html($(this).attr("name"))}),$(".main-bottom .bottom-btn").click(function(){var t=$.trim($(".main-bottom .bottom-txt").val());if(""==t)$(".main-bottom .bottom-msg").show();else{var a=new RongIMLib.TextMessage({content:t,extra:"客服回复"}),n=RongIMLib.ConversationType.PRIVATE,i=$(".main-left ul li.current").attr("name");RongIMClient.getInstance().sendMessage(n,i,a,{onSuccess:function(a){var n='<div class="talker-a"><div class="talker-content">'+t+'</div>&nbsp;<div class="talker-img"></div></div>';$(".main-bottom .bottom-txt").val(""),$(".main-talking .talking-list:visible").append(n),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400),$.ajax({type:"POST",url:"https://mm.jnrise.cn:88/loading/server/kefu/send",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{fromUserId:"rise",toUserId:i,content:t},dataType:"json",success:function(t){console.log(t)},error:function(t){console.log(t)}})}})}}),$(".main-bottom .bottom-txt").focus(function(){$(".main-bottom .bottom-msg").hide()})}),$(document).keydown(function(t){13===t.keyCode&&$(".main-bottom .bottom-btn").trigger("click")});