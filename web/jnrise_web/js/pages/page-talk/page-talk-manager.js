function initMessages(t){""!=t&&$.ajax({type:"POST",url:"https://mm.jnrise.cn:88/loading/server/kefu/history ",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{fromId:"rise",toId:t},dataType:"json",success:function(a){if(null!=a.rongMessages&&a.rongMessages.length>0){for(var e="",n=a.rongMessages.length-1;n>=0;n--)a.rongMessages[n].fromUserId==t?e+='<div class="talker-b"><div class="talker-img"></div><div class="talker-content">'+a.rongMessages[n].message+"</div></div>":"rise"==a.rongMessages[n].fromUserId&&(e+='<div class="talker-a"><div class="talker-content">'+a.rongMessages[n].message+'</div><div class="talker-img"></div></div>');$(".main-talking .talking-list[data-id="+t+"]").html(e)}},error:function(t){console.log(t)}})}function getScrollHeight(){var t=0,a=0;return document.body&&(t=document.body.scrollHeight),document.documentElement&&(a=document.documentElement.scrollHeight),t-a>0?t:a}function isInArray(t,a){for(var e=0;e<t.length;e++)if(a===t[e])return!0;return!1}$(function(){var t={appKey:"qd46yzrfqi2cf",token:"i8aJP8kL+MlVWCVtVawex6+1t+T+IPc7BMxpTPLARm8C/oo23Hbk7ifZXvwbJl9IQqTqnNh7GBlbSk9UvSk2iA=="},a={receiveNewMessage:function(t){if($(".main-left ul li.current").attr("name")==t.targetId){var a='<div class="talker-b"><div class="talker-img"></div>&nbsp;<div class="talker-content">'+t.content.content+"</div></div>";$(".main-talking .talking-list:visible").append(a),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}else if(isInArray(e,t.targetId))$(".main-left ul li[name="+t.targetId+"] span").show();else{e.push(t.targetId);var n='<li name="'+t.targetId+'"><img src="http://cdn.tianyalei.com/mm/rise/page-talk/default.png"><span></span><p>'+t.targetId+"</p></li>",i='<div class="talking-list" data-id="'+t.targetId+'" style="display:none"></div>';$(".main-left ul").append(n),$(".main-right .main-talking").append(i),$(".main-left ul li[name="+t.targetId+"] span").show()}}};init(t,a);var e=[];$.ajax({type:"POST",url:"https://mm.jnrise.cn:88/loading/server/kefu/contact",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{kefuId:"rise"},dataType:"json",success:function(t){if(console.log(t),null!=t.data&&t.data.length>0){e=t.data;for(var a="",n="",i=0;i<t.data.length;i++)a+='<li name="'+t.data[i]+'"><img src="http://cdn.tianyalei.com/mm/rise/page-talk/default.png"><span></span><p>'+t.data[i]+"</p></li>",n+='<div class="talking-list" data-id="'+t.data[i]+'"></div>';$(".main-left ul").append(a),$(".main-right .main-talking").append(n),$(".main-left ul li").removeClass("current").eq(0).addClass("current"),$(".main-right .main-talking .talking-list").hide().eq(0).show(),$(".main-right .main-header h4 span").html(t.data[0]),initMessages($(".main-left ul li").eq(0).attr("name")),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}},error:function(t){console.log(t)}}),$(".main-left ul").on("click","li",function(){var t=$(this).index();$(".main-left ul li").removeClass("current").eq(t).addClass("current").find("span").hide(),$(".main-right .main-talking .talking-list").hide().eq(t).show(),$(".main-right .main-header h4 span").html($(this).attr("name")),initMessages($(this).attr("name")),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400)}),$(".main-bottom .bottom-btn").click(function(){var t=$.trim($(".main-bottom .bottom-txt").val());if(""==t)$(".main-bottom .bottom-msg").show();else{var a=new RongIMLib.TextMessage({content:t,extra:"客服回复"}),e=RongIMLib.ConversationType.PRIVATE,n=$(".main-left ul li.current").attr("name");RongIMClient.getInstance().sendMessage(e,n,a,{onSuccess:function(a){var e='<div class="talker-a"><div class="talker-content">'+t+'</div>&nbsp;<div class="talker-img"></div></div>';$(".main-bottom .bottom-txt").val(""),$(".main-talking .talking-list:visible").append(e),$(".main-talking").animate({scrollTop:getScrollHeight()-$(".main-talking").height()},400),$.ajax({type:"POST",url:"https://mm.jnrise.cn:88/loading/server/kefu/send",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{fromUserId:"rise",toUserId:n,content:t},dataType:"json",success:function(t){console.log(t)},error:function(t){console.log(t)}})}})}}),$(".main-bottom .bottom-txt").focus(function(){$(".main-bottom .bottom-msg").hide()})}),$(document).keydown(function(t){13===t.keyCode&&$(".main-bottom .bottom-btn").trigger("click")});